# Coverage and Uniformity analysis with MosDepth
this script calculates per base coverage, threshold coverage, run uniformity, 95% central fold diff, 
and plots correlation heatmap and per base coverage histogram

## DEPENDENCIES
`dependency.yml`<br />
`https://github.com/brentp/mosdepth`

## Scripts

```
wrapper_for_mosdepth.sh: 
    The driver script that calls different script and manage jobs
    usage: `bash wrapper_for_mosdepth.sh $your_bed_file`

mosdepth.job:
    job template file for qsubing individul samples
    usage: `qsub -v bam=$bam -v bed=$BED mosdepth.job`
    output: "*.regions.bed.gz", "*.thresholds.bed.gz", "*.mosdepth.summary.txt"

compile_mosdepth_exonStat.py:
    compiles all the mosdepth results from *.regions.bed.gz, *.thresholds.bed.gz, and *.mosdepth.summary.txt 
    from mosdepth and detects any target with any sample below the coverage threshold
    usage: `python compile_mosdepth_exonStat.py $coverage_threshold`
    output: `PerTargetThresholdCov.xlsx` and `PerTargetThresholdCov.xlsx`

corr_heatmap.py:
    uses PerTargetThresholdCov.xlsx to plot in-run sample cov correlation heatmap
    usage: `python corr_heatmap.py PerTargetThresholdCov.xlsx`
    output: `correlation_heatmap.png`

cal_quantile_plot_per_base.py:
    uses .coverage file generated by mosdepth.job to calculate uniformity metrics and plot per base coverage distribution
    usage: `python cal_quantile_plot_per_base.py`
    output: "Central95FoldDiff.xlsx", "Avg_PerBaseCovHist.png"

To do list:
    update high level wrapper to python script and add paremater using argparse
```

## updated script in progress:
```
get_coverage_info.py:
usage: get_coverage_info.py [-h] --bam_list BAM_LIST --bed BED [--heatmap]
                            [--outdir OUTDIR]

available arguments:
  -h, --help           show this help message and exit
  --bam_list BAM_LIST  [Input] list of bam fils for cov analysis
  --bed BED            [Input] target bed file where 4th column has the $gene_exon info
  --heatmap            [Optional] to genrate correlation heatmap
  --outdir OUTDIR      [Optional] Path to output directory
```